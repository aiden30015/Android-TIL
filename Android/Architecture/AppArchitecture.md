# AppArchitecture

아키텍처는 앱의 전반적인 유지관리성,품질,견고성이 개선된다. 또한 앱을 확장 할 수 있으며 코드 출동이 최소하되어 더 많은 인력과 팀이 동일한 코드베이스에 기여할 수 있다. 그리고 테스트하기가 더쉽다.

## 아키텍처 원칙

Android 앱은 크기가 커지기 때문에 앱을 확장하고 앱의 견고성을 높이며 앱을 더 쉽게 테스트 할 수 있도록 아키텍처를 사용한다.  
앱 아키텍처는 앱의 부분과 그 각 부분에 필요한 기능 간의 경계를 정의한다.  
위에 언급된 요구사항을 충족하려면 몇 가지 특정 원칙을 준수하면서 앱 아키텍처를 설계해야 한다.

## 관심사 분리

`Activity`,`Fragment` 같은 UI 기반의 클래스는 UI 및 운영체제 상호작용을 처리하는 로직만 포함해야 한다.  
이러한 클래스를 최대한 가볍게 유지하여 구성요소 수명 주기와 관련된 많은 문제를 피하고 그러한 클래스의 테스트 가능성을 개선할 수 있다.

## 데이터 모델에서 UI 도출하기

데이터 모델은 앱의 UI 요소 및 기타 구성요소로부터 독립되어 있다. 즉 이들은 UI 및 앱 구성요소 수명 주기와는 관련이 없다. **하지만** OS가 메모리에서 앱의 프로세스를 삭제하기로 결정하면 데이터 모델도 삭제됩니다.

가급적이면 지속적인 모델을 권장한다 왜 일까?

- Android OS에서 리소스를 확보하기 위해 앱을 제거해도 사용자 데이터가 삭제되지 않는다
- 네트워크 연결이 취약하거나 연결되어 있지 않아도 앱이 계속 작동합니다.

## 단일 소스 저장소

앱에서 새로운 데이터 유형을 정의할 때는 데이터 유형에 단일 소스 저장소(SSOT)를 할당해야 합니다.  
SSOT는 데이터의 소유자이며, SSOT만 데이터를 수정하거나 변경할 수 있다. 이를 위해 불변 유형을 사용하여 데이터를 노출하며,다른 유형이 호출할 수 있는 이벤트를 수신하거나 함수를 노출하여 데이터를 수정합니다.  
이 패턴에는 여러가지 이점이 있다.

- 특정 유형 데이터의 모든 변경사항을 한곳으로 일원화합니다.
- 다른 유형이 조작할 수 없도록 데이터를 보호합니다.
- 데이터 변경사항을 더 쉽게 추적할 수 있도록 한다. -> 버그 발견하기 쉽다  
  오프라인 중심 애플리케이션의 애플리케이션 데이터 정보 소스는 주로 DB이다. 정보 소스가 ViewModel이거나 UI인 경우도 있다.

## 단방향 데이터 흐름

단일 소스 저장소 원칙은 Google 가이드에서 종종 UDF 패턴과 함께 사용된다. UDF에서 상태는 한 방향으로만 흐른다. 데이터를 수정하는 이벤트는 반대 방향으로 흐른다.

상태 또는 데이터는 일반적으로 계층 구조의 상위 범위 유형에서 하위 범위 유형으로 흐른다. 이벤트는 보통 하휘 범위 유형에서 트리거되어 상응하는 데이터 유형의 SSOT에 도달한다.  
예를 들어 애플리케이션 데이터는 보통 데이터 소스에서 UI로 흐른다. 사용자 이벤트는 UI에서 SSOT로 흐르며, SSOT에서는 애플리케이션 데이터가 불변 유형이다.

이 패턴은 데이터 일관성을 강화하고, 오류가 발생할 확률을 줄이며, 디버그 하기 쉽고, SSOT 패턴의 모든이점을 제공한다.

## 권장 앱 아키텍처

각 애플리케이션에는 최소한 두 가지 레이어가 포함되어햐 한다.

- 화면에 애플리케이션 데이터를 표시하는 UI 레이어
- 앱의 비즈니스 로직을 포함하고 애플리케이션 데이터를 노출하는 데이터 레이어
  UI와 데이터 레이어 간의 상호작용을 간소화하고 재사용하기 위한 도메인 레이어라는 레이어를 추가할 수 있다.

## 최신 앱 아키텍처

이 최신 앱 아키텍처에서는 다음 기법을 사용하도록 권장한다.

- 반응형 및 계층형 아키텍처
- 앱의 모든 레이어에서의 단방향 데이터 흐름(UDF)
- 상태 홀더가 있는 UI 레이어로 UI의 복잡성 관리
- 코루틴 및 흐름
- 종속 항목 삽입 권장사항

## UI레이어

화면에 애플리케이션 데이터를 표시한다. 사용자 상호작용 또는 외부 입력으로 인해 데이터가 변할 때마다 변경사항을 반영하도록 UI가 업데이트 되어야한다.  
UI레이어는 다음 두 가지로 구성된다.

- 화면에 데이터를 렌더링하는 UI 요소. 이러한 요소는 뷰또는 Jetpack Compose 함수를 사용하여 빌드할 수 있습니다
- 데이터를 보유하고 이를 Ui에 노출하며 로직을 처리하는 상태 홀더(예:ViewModel 클래스)

## 데이터 레이어

앱의 데이터 레이어에는 비즈니스 로직이 포함되어 있다. 비즈니스 로직은 앱의 가치를 부여하는 요소로, 앱의 데이터 생성, 저장, 변경 방식을 결정하는 규칙으로 규성된다.  
데이터 레이어는 0개부터 여러 개의 데이터 소스를 각각 포함할 수 있는 저장소로 구성된다.  
저장소 클래스에서 담당하는 작업은 다음과 같다

- 앱의 나머지 부분에 데이터 노출
- 데이터 변경사항을 한 곳에 집중
- 여러 데이터 소스 간의 충돌 해결
- 앱의 나머지 부분에서 데이터 소스 추상화
- 비즈니스 로직 포함

## 도메인 레이어

도메인 레이어는 UI 레이어와 데이터 레이어 사이에 있는 **선택적 레이어**이다.  
복잡한 비즈니스 로직이나 여러 ViewModel에서 재사용되는 간단한 비즈니스 로직의 캡슐화를 담당한다. 모든앱에 이러한 요구사항이 아니라 선택사항이라는 것이다.
